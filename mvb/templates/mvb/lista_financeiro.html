{% extends 'mvb/base.html' %}
{% block content %}

<h1 class="mb-3">Controle Financeiro</h1>

<div class="mb-3">
  <a class="btn btn-success" href="{% url 'adicionar_financeiro' %}">
    <i class="fas fa-plus"></i> Adicionar Financeiro
  </a>

  <a class="btn btn-primary"
     href="{% url 'mvb_dashboard' %}">
    Voltar
  </a>
</div>

<form id="financeiroForm">

  <table class="table table-bordered table-striped table-hover">
    <thead class="table-dark">
      <tr>
        <th style="width:40px;"></th>
        <th>Data</th>
        <th>Salários</th>
        <th>Frete</th>
        <th>Café</th>
        <th>Almoço</th>
        <th>Contabilidade</th>
        <th>INSS</th>
        {% if request.user.is_staff %}
        <th>Total</th>
        {% endif %}
      </tr>
    </thead>

    <tbody>
      {% if financeiros %}
        {% for f in financeiros %}
          <tr>
            <td class="text-center">
              <input type="radio" name="financeiro_id" value="{{ f.id }}">
            </td>
            <td>{{ f.data|date:"d/m/Y" }}</td>
            <td>R$ {{ f.salario_total_funcionarios }}</td>
            <td>R$ {{ f.frete }}</td>
            <td>R$ {{ f.refeicao_cafe }}</td>
            <td>R$ {{ f.refeicao_almoco }}</td>
            <td>R$ {{ f.contabilidade }}</td>
            <td>R$ {{ f.inss }}</td>
            {% if request.user.is_staff %}
            <td><strong>R$ {{ f.total }}</strong></td>
            {% endif %}
          </tr>
        {% endfor %}
      {% else %}
        <tr>
          <td colspan="11" class="text-center text-muted">
            Nenhum lançamento cadastrado
          </td>
        </tr>
      {% endif %}
    </tbody>
  </table>

  <div class="d-flex gap-2 mt-3">
    <button type="button" class="btn btn-primary" onclick="editarFinanceiro()">
      Editar selecionado
    </button>

    <button type="button" class="btn btn-danger" onclick="excluirFinanceiro()">
      Excluir selecionado
    </button>
  </div>

</form>

{% if financeiros.has_other_pages %}
  <nav>
    <ul class="pagination justify-content-center">

      {% if financeiros.has_previous %}
        <li class="page-item">
          <a class="page-link" href="?page=1">&laquo; Primeira</a>
        </li>
        <li class="page-item">
          <a class="page-link" href="?page={{ financeiros.previous_page_number }}">Anterior</a>
        </li>
      {% endif %}

      <li class="page-item active">
        <span class="page-link">
          Página {{ financeiros.number }} de {{ financeiros.paginator.num_pages }}
        </span>
      </li>

      {% if financeiros.has_next %}
        <li class="page-item">
          <a class="page-link" href="?page={{ financeiros.next_page_number }}">Próxima</a>
        </li>
        <li class="page-item">
          <a class="page-link" href="?page={{ financeiros.paginator.num_pages }}">Última &raquo;</a>
        </li>
      {% endif %}

    </ul>
  </nav>
{% endif %}

<script>
function getFinanceiroSelecionado() {
  const selecionado = document.querySelector(
    'input[name="financeiro_id"]:checked'
  );
  return selecionado ? selecionado.value : null;
}

function editarFinanceiro() {
  const id = getFinanceiroSelecionado();

  if (!id) {
    alert("Selecione um registro para editar.");
    return;
  }

  window.location.href = `/financeiro/${id}/editar/`;
}

function excluirFinanceiro() {
  const id = getFinanceiroSelecionado();

  if (!id) {
    alert("Selecione um registro para excluir.");
    return;
  }

  if (confirm("Deseja realmente excluir este lançamento?")) {
    window.location.href = `/financeiro/${id}/excluir/`;
  }
}
</script>

{% endblock %}




